# Acceptance Criteria (EARS)

## Ubiquitous Requirements

*   **U1:** The `rabuf` library shall handle I/O errors gracefully by returning `std::io::Result`.
*   **U2:** The `rabuf` library shall provide comprehensive documentation and usage examples.

## Event-Driven Requirements

*   **EV1:** When a `RaBuf` instance is created, the system shall initialize a new buffered reader/writer for the specified `File`.
*   **EV2:** When a read or write operation is performed, the system shall perform the I/O in fixed-size chunks.
*   **EV3:** When the `seek` method is called, the system shall move the internal cursor to the specified position within the file.
*   **EV4:** When a file chunk is accessed, the system shall cache it in memory.
*   **EV5:** When the cache is full and a new chunk needs to be added, the system shall evict the least frequently used chunk.
*   **EV6:** When a `RaBuf` instance goes out of scope, the system shall flush all buffered data to the underlying file.
*   **EV7:** When the `set_len` method is called, the system shall truncate or extend the underlying file to the specified size.
*   **EV8:** When the `sync_all` or `sync_data` method is called, the system shall synchronize the file's in-memory state with the disk.

## Optional Feature Requirements

*   **O1:** Where the `buf_auto_buf_size` feature is enabled, the system shall automatically adjust the buffer size based on the file size.
*   **O2:** Where the `buf_hash_turbo` feature is enabled, the system shall use a faster hash map implementation for chunk lookups.
*   **O3:** Where the `buf_myhash` feature is enabled, the system shall use a custom hasher for the hash map.
*   **O4:** Where the `buf_lru` feature is enabled, the system shall use a Least Recently Used (LRU) cache eviction strategy instead of LFU.
*   **O5:** Where the `buf_stats` feature is enabled, the system shall collect and expose statistics about buffer usage.
*   **O6:** Where the `buf_print_hits` feature is enabled, the system shall print cache hit/miss statistics to stderr.
*   **O7:** Where the `buf_debug` feature is enabled, the system shall enable debug assertions and other debugging aids.
*   **O8:** Where the `buf_overf_rem` feature is enabled, the system shall control the behavior when the buffer overflows.

## State-Driven Requirements

*   **S1:** While the `RaBuf` instance is active, the system shall allow both reading from and writing to the buffered file.

## Unwanted Behavior Requirements

*   **UW1:** The `rabuf` library shall prevent data loss by ensuring all dirty chunks are written to disk before closing the file.
*   **UW2:** The `rabuf` library shall prevent unnecessary I/O operations by utilizing the in-memory cache whenever possible.
